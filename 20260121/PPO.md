
```
                    ┌─────────────────────┐
                    │   PPO训练主循环       │
                    └──────────┬──────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        │                      │                      │
        ▼                      ▼                      ▼
  ┌──────────┐          ┌──────────┐          ┌──────────┐
  │  生成阶段 │          │  评价阶段 │          │  更新阶段  │
  └─────┬────┘          └─────┬────┘          └─────┬────┘
        │                     │                      │
   ┌────┴────┐           ┌────┴─────────┐      ┌─────┴────────┐
   │ Actor   │           │ RM + RefPolicy│     │ Actor Update │
   │Generate │           │   并行计算     │     │ Critic Update│
   └────┬────┘           └────┬─────────┘      └──────────────┘
        │                     │                      ▲
        │              ┌──────┴──────┐               │
        │              ▼             ▼               │
        │         ┌────────┐    ┌────────┐           │
        │         │ Reward │    │old_logp│           │
        │         │  r(s,a)│    │ref_logp│           │
        │         └───┬────┘    └───┬────┘           │
        │             │             │                │
        │             └──────┬──────┘                │
        │                    ▼                       │
        │              ┌───────────┐                 │
        │              │ r' = r - β·KL               │
        │              └─────┬─────┘                 │
        ▼                    │                       │
   ┌─────────┐              │                        │
   │ Critic  │              │                        │
   │ V(s_t)  │              │                        │
   └────┬────┘              │                        │
        │                   │                        │
        └────────┬──────────┘                        │
                 ▼                                   │
           ┌──────────┐                              │
           │   GAE    │  A_t = Σ(γλ)^k·δ_{t+k}       │
           │ δ=r'+γV-V│                              │
           └─────┬────┘                              │
                 ▼                                   │
           ┌──────────┐                              │
           │Advantage │                              │
           │   A(s,a) │──────────────────────────────┘
           └──────────┘
```
