# 解码加速算法
## 指标

### GPU 算力和 带宽

`算力`： GPU 每秒能够进行的浮点运算次数，单位是 FLOP/s；

`带宽`：该显卡每秒能够进行的显存读写量，单位是 byte/s。

`计算强度上限` 𝐼𝑚𝑎𝑥：算力和带宽的比值，单位为 FLOP/byte。

`模型的理论性能` ：最关心的指标，即模型在计算平台上所能达到的每秒浮点运算次数（理论值）。单位是FLOPS or FLOP/s。

### 运算量和访存量

`运算量`是指运行该模型需要的总浮点计算数，单位为 FLOP

`访存量`是运行该模型的过程中所需的显存读写量，单位为 byte

运算量和访存量的比值被称为该模型的`计算强度 𝐼`，单位为 FLOP/byte

`带宽瓶颈`：  计算强度 𝐼 < GPU 的计算强度上限 𝐼𝑚𝑎𝑥 , 说明 GPU 的理论最高显存读写速度低于实际运
算所需速度, 受到`带宽`影响

`计算瓶颈`: 𝐼 大于 𝐼𝑚𝑎𝑥 ，说明 GPU 的理论最高浮点运算速度低于实际运算所需速度, 受到`算力`影响

### Roof-line 的形态：
算力决定“屋顶”的高度（绿色线段）
带宽决定“房檐”的斜率（红色线段）
![image](https://github.com/hinswhale/AI-Learning/assets/22999866/d9452ee2-af04-4373-9582-9ceaf6ba2cf1)

Roof-line 划分出的两个瓶颈区域
![image](https://github.com/hinswhale/AI-Learning/assets/22999866/7db542ab-a49a-4a9e-a18c-d48243228e46)

计算瓶颈区域 Compute-Bound
不管模型的计算强度 有多大，它的理论性能最大只能等于计算平台的算力。当模型的计算强度大于计算平台的计算强度上限时，模型在当前计算平台处于 Compute-Bound状态，即模型的理论性能受到计算平台算力的限制，无法与计算强度成正比。但这其实并不是一件坏事，因为从充分利用计算平台算力的角度上看，此时模型已经 的利用了计算平台的全部算力。可见，计算平台的算力越高，模型进入计算瓶颈区域后的理论性能也就越大。

带宽瓶颈区域 Memory-Bound
当模型的计算强度小于计算平台的计算强度上限时，由于此时模型位于“房檐”区间，因此模型理论性能的大小完全由计算平台的带宽上限（房檐的斜率）以及模型自身的计算强度所决定，因此这时候就称模型处于 Memory-Bound 状态。可见，在模型处于带宽瓶颈区间的前提下，计算平台的带宽越大（房檐越陡），或者模型的计算强度越大，模型的理论性能可呈线性增长。

`roofline模型讲的是程序可以达到的最好性能，而不是实际达到的性能。例如矩阵乘法，计算密度是N。但是因为cache大小的限制，GEMM实现的优劣，硬件的其他限制，你未必（或者说，几乎并不能）能达到roofline模型所定义的边界（屋顶）。`

