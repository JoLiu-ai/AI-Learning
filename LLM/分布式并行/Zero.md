## 模型参数占比

|**模型状态（Model States）** |**显存占用**                     | **说明**                                                                 |
|------------------------------|-----------------------------------|--------------------------------------------------------------------------|
| **参数（Parameters）**        | FP16 / **2Φ**                    | 模型权重，使用FP16存储（2字节/参数）                                     |
| **梯度（Gradients）**         | FP32 / **4Φ**                    | 反向传播计算的梯度，通常以FP32存储（4字节/参数）                          |
| **优化器状态（Optimizer States）** | 不同优化器显存占用不同（**KΦ**）<br>**K**：每个参数对应的优化器状态所占的字节数<br>                             **Adam示例：K=12Φ**              | 1. Master Weight（FP32，4Φ）<br>2. 动量（FP32，4Φ）<br>3. 方差（FP32，4Φ） |
| **残存状态（Residual States）** | 动态占用                        | 1. 激活值（Activations）<br>2. 临时缓冲区（Temporary Buffers）<br>3. 碎片化内存（Fragmented Memory） |
|                              | **激活函数**                     | 如Sigmoid、ReLU等，赋予网络非线性能力（a = g(z)                          |

## **不同优化器的** *K* **值对照表**

| 优化器类型 | 优化器状态组成 | K值（字节/参数） | 说明 |
| --- | --- | --- | --- |
| **SGD** | 无状态 | 0 | 仅使用梯度更新参数，无额外状态。 |
| **SGD + 动量** | 动量（FP32） | 4 | 每个参数存储动量（4字节）。 |
| **Adam** | 动量（FP32） + 方差（FP32） | 8 | 标准Adam优化器，不包含FP32参数副本。<br>- 动量（momentum）：记录梯度的移动平均。<br>- 方差估计（variance estimate）：记录梯度平方的移动平均。 |
| **Adam（含FP32副本）** | 动量（FP32） + 方差（FP32） + FP32参数副本 | 12 | 包含维护的FP32参数副本（4字节），常见于PyTorch混合精度训练。 |
| **Adagrad** | 梯度平方累积（FP32） | 4 | 每个参数存储梯度平方累积值（4字节）。 |
| **RMSProp** | 梯度平方移动平均（FP32） | 4 | 类似Adagrad，但使用指数移动平均。 |

---
## zero stages
![image](https://github.com/user-attachments/assets/e713263c-f460-4833-be5a-c94092124471)

> N_d：数据并行度（GPU数量)
K：优化器状态系数（如Adam中K=12，SGD中K=0）
>
